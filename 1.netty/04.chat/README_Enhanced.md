# Netty èŠå¤©ç³»ç»Ÿå¢žå¼ºç‰ˆ

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª Netty èŠå¤©ç³»ç»Ÿï¼ŒæœåŠ¡ç«¯æ”¯æŒå‘å›ºå®šç”¨æˆ·å‘é€æ¶ˆæ¯ã€å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚

## enhanced åŠŸèƒ½
* æœåŠ¡ç«¯ï¼šcom.whosly.stars.netty.chat.server.enhanced 
  + EnhancedChatServerï¼šè°ƒç”¨ start(PORT, new EnhancedServerChannelInitializer(), consumer)ï¼›consumer æ‰“å°å¯åŠ¨æŒ‡å¼• 
  + EnhancedServerChannelInitializerï¼šæŒ‚è½½ StringDecoderã€StringEncoderã€EnhancedChatServerHandler 
  + EnhancedChatServerHandlerï¼šæ”¯æŒ 
    - @ç”¨æˆ·å:æ¶ˆæ¯ æˆ– @ID:æ¶ˆæ¯ ç§èŠï¼ˆID ä¸º channel.id().asShortText()ï¼‰ 
    - /name æ–°å æ”¹åï¼ˆåŽ»é‡ï¼‰ 
    - /users æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·ï¼ˆç”¨æˆ·åä¸ŽIDï¼‰ 
    - æ™®é€šæ¶ˆæ¯ä»…å›žå‘å‘é€è€…ï¼›#å¹¿æ’­: å¯é€‰å¹¿æ’­

* å®¢æˆ·ç«¯ï¼šcom.whosly.stars.netty.chat.client.enhanced 
  + EnhancedChatClientï¼šåŸºäºŽ Netty Bootstrap å¯åŠ¨ï¼Œæ·»åŠ å­—ç¬¦ä¸²ç¼–è§£ç å™¨ä¸Ž EnhancedChatClientHandlerï¼Œä½¿ç”¨ try-with-resources ç®¡ç† Scanner 
  + EnhancedChatClientHandlerï¼šæ‰“å°æ¶ˆæ¯ã€è¿žæŽ¥/æ–­å¼€æç¤ºä¸Žå¼‚å¸¸å¤„ç†

## ä½¿ç”¨æ–¹æ³•
* å¯åŠ¨æœåŠ¡ç«¯ï¼šcom.whosly.stars.netty.chat.server.enhanced.EnhancedChatServer
* å¯åŠ¨å®¢æˆ·ç«¯ï¼šcom.whosly.stars.netty.chat.client.enhanced.EnhancedChatClient
  + å®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ï¼Œä¼šè¦æ±‚ç”¨æˆ·è¾“å…¥è‡ªå®šä¹‰ç”¨æˆ·åã€‚è¯¥ç”¨æˆ·åè‡ªå®šä¹‰ä¹‹åŽï¼Œ å®¢æˆ·ç«¯ä¼šè¿žæŽ¥å»ºç«‹åŽè‡ªåŠ¨å‘é€ä¸€æ¬¡â€œ/name ç”¨æˆ·åâ€ï¼ŒæœåŠ¡ç«¯çš„ EnhancedChatServerHandler ä¼šç”¨è¯¥ç”¨æˆ·åæ›¿æ¢ä¸´æ—¶åï¼Œä»Žè€Œå®Œæˆç”¨æˆ·åä¸Žè¯¥ channel ID çš„ç»‘å®šã€‚ã€‚
* å‘½ä»¤ä¸Žæ ¼å¼ï¼š
  + ç§èŠï¼š@ç”¨æˆ·å:æ¶ˆæ¯ æˆ– @ID:æ¶ˆæ¯ 
  + æ”¹åï¼š/name æ–°å 
  + åœ¨çº¿ç”¨æˆ·ï¼š/users, è¾“å‡ºæ ¼å¼ä¸º `yourName (ID=xxxx) `
  + å¹¿æ’­ï¼š#å¹¿æ’­:å†…å®¹ 
  + é€€å‡ºï¼š/quit

### 1. æ¶ˆæ¯è·¯ç”±æœºåˆ¶
- **æ™®é€šæ¶ˆæ¯**ï¼šåªå‘å‘é€è€…å›žå¤ï¼Œä¸ä¼šå¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯
- **ç§èŠæ¶ˆæ¯**ï¼šæ”¯æŒæŒ‡å®šç”¨æˆ·åçš„ç§èŠåŠŸèƒ½
- **å¹¿æ’­æ¶ˆæ¯**ï¼šå¯é€‰æ‹©æ€§åœ°å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰ç”¨æˆ·
- **ç³»ç»Ÿæ¶ˆæ¯**ï¼šç”¨æˆ·ä¸Šçº¿ã€ä¸‹çº¿ç­‰ç³»ç»Ÿé€šçŸ¥

### 2. ç”¨æˆ·ä½“éªŒæå‡
- æ¸…æ™°çš„æ¶ˆæ¯ç±»åž‹æ ‡è¯†ï¼ˆä½¿ç”¨emojiå›¾æ ‡ï¼‰
- è¯¦ç»†çš„è¿žæŽ¥çŠ¶æ€æç¤º
- å‹å¥½çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æŒ‡å¯¼

### 3. çº¿ç¨‹å®‰å…¨
- ä½¿ç”¨ `ConcurrentHashMap` ç®¡ç†å®¢æˆ·ç«¯è¿žæŽ¥
- æ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘è¿žæŽ¥

## é…ç½®

é…ç½®æ–‡ä»¶ï¼š`src/main/resources/application.properties`

```properties
server.port=8080
server.host=localhost
```

## æž¶æž„è¯´æ˜Ž

### æœåŠ¡å™¨ç«¯
- `EnhancedChatServerHandler`: æ ¸å¿ƒæ¶ˆæ¯å¤„ç†é€»è¾‘
- `EnhancedChatServer`: æœåŠ¡å™¨å¯åŠ¨ç±»
- `EnhancedServerChannelInitializer`: é€šé“åˆå§‹åŒ–å™¨

### å®¢æˆ·ç«¯
- `EnhancedChatClientHandler`: å®¢æˆ·ç«¯æ¶ˆæ¯å¤„ç†
- `EnhancedChatClient`: å®¢æˆ·ç«¯å¯åŠ¨ç±»

### å…³é”®ç‰¹æ€§
1. **æ¶ˆæ¯éš”ç¦»**ï¼šæ™®é€šæ¶ˆæ¯ä¸ä¼šå½±å“å…¶ä»–å®¢æˆ·ç«¯
2. **é€‰æ‹©æ€§å¹¿æ’­**ï¼šåªæœ‰æ˜Žç¡®æ ‡è®°çš„å¹¿æ’­æ¶ˆæ¯æ‰ä¼šå‘é€ç»™æ‰€æœ‰ç”¨æˆ·
3. **è¿žæŽ¥ç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†å®¢æˆ·ç«¯è¿žæŽ¥å’Œæ–­å¼€
4. **é”™è¯¯å¤„ç†**ï¼šå‹å¥½çš„é”™è¯¯æç¤ºå’Œå¼‚å¸¸å¤„ç†


## ä¾‹å­

### 1. æ™®é€šæ¶ˆæ¯
ç›´æŽ¥è¾“å…¥æ–‡æœ¬å†…å®¹ï¼ŒæœåŠ¡å™¨åªå‘å‘é€è€…å›žå¤ç¡®è®¤ã€‚

**ç¤ºä¾‹ï¼š**
```
> ä½ å¥½ï¼Œä¸–ç•Œï¼
âœ… æœåŠ¡å™¨å·²æ”¶åˆ°æ‚¨çš„æ¶ˆæ¯: ä½ å¥½ï¼Œä¸–ç•Œï¼
```

### 2. ç§èŠæ¶ˆæ¯
ä½¿ç”¨ `@ç”¨æˆ·å:æ¶ˆæ¯å†…å®¹` æˆ–è€…  `@ç”¨æˆ·ID:æ¶ˆæ¯å†…å®¹` æ ¼å¼å‘é€ç§èŠæ¶ˆæ¯ã€‚

**ç¤ºä¾‹ï¼š**
```
> @Client_123: ä½ å¥½ï¼
ðŸ”’ ç§èŠæ¶ˆæ¯ [Client_456]: ä½ å¥½ï¼
âœ… ç§èŠæ¶ˆæ¯å·²å‘é€ç»™ Client_123
```

### 3. å¹¿æ’­æ¶ˆæ¯
ä½¿ç”¨ `#å¹¿æ’­:æ¶ˆæ¯å†…å®¹` æ ¼å¼å‘é€å¹¿æ’­æ¶ˆæ¯ã€‚

**ç¤ºä¾‹ï¼š**
```
> #å¹¿æ’­:å¤§å®¶å¥½ï¼
ðŸ“¢ å¹¿æ’­æ¶ˆæ¯ [Client_456]: å¤§å®¶å¥½ï¼
âœ… å¹¿æ’­æ¶ˆæ¯å·²å‘é€ç»™æ‰€æœ‰åœ¨çº¿ç”¨æˆ·
```

### 4. ç³»ç»Ÿå‘½ä»¤

#### æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·
```
> /users
ðŸ‘¥ åœ¨çº¿ç”¨æˆ·åˆ—è¡¨:
- Client_123
- Client_456
- Client_789
```

#### é€€å‡ºèŠå¤©
```
> /quit
æ­£åœ¨é€€å‡ºèŠå¤©...
ä¸ŽæœåŠ¡å™¨çš„è¿žæŽ¥å·²æ–­å¼€
```

## æ•ˆæžœå±•ç¤º

> EnhancedChatServer

```
å·²è¿žæŽ¥åˆ°åœ°å€ä¸º ''127.0.0.1:62571'ï¼Œä¼ è¾“: 'å¥—æŽ¥å­—'' çš„ç›®æ ‡è™šæ‹Ÿæœº
Chat Server started. Ready to accept chat clients.

å¢žå¼ºç‰ˆèŠå¤©æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç«¯å£: 8080
æ”¯æŒåŠŸèƒ½ï¼š
1. æ™®é€šæ¶ˆæ¯ï¼šåªå‘å‘é€è€…å›žå¤
2. ç§èŠæ¶ˆæ¯ï¼š@ç”¨æˆ·å:æ¶ˆæ¯å†…å®¹
3. å¹¿æ’­æ¶ˆæ¯ï¼š#å¹¿æ’­:æ¶ˆæ¯å†…å®¹
4. æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·ï¼š/users
5. é€€å‡ºèŠå¤©ï¼š/quit

[RENAME] Client_070c91c2 -> poy
[RENAME] Client_8549e568 -> alias
[NORMAL] poy: \/users
[DM] poy -> alias: ä½ åœ¨å“ªå„¿
[DM] alias -> poy: beijing
[DM] poy -> alias: o
[DM] alias -> poy: ä½ å‘¢

```

> EnhancedChatClient A ç”¨æˆ·

```
å·²è¿žæŽ¥åˆ°åœ°å€ä¸º ''127.0.0.1:62658'ï¼Œä¼ è¾“: 'å¥—æŽ¥å­—'' çš„ç›®æ ‡è™šæ‹Ÿæœº
è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å: 
alias
æ¬¢è¿Ž alias åŠ å…¥èŠå¤©å®¤ï¼
å·²è¿žæŽ¥åˆ°æœåŠ¡å™¨ localhost:8080
å·²è¿žæŽ¥åˆ°èŠå¤©æœåŠ¡å™¨ï¼

ðŸŽ‰ æ¬¢è¿Žè¿žæŽ¥åˆ°èŠå¤©æœåŠ¡å™¨ï¼
ä½¿ç”¨è¯´æ˜Žï¼š
1. æ™®é€šæ¶ˆæ¯ï¼šç›´æŽ¥è¾“å…¥å†…å®¹
2. ç§èŠæ¶ˆæ¯ï¼š@ç”¨æˆ·å:æ¶ˆæ¯å†…å®¹ æˆ– @8549e568:æ¶ˆæ¯å†…å®¹
3. å¹¿æ’­æ¶ˆæ¯ï¼š#å¹¿æ’­:æ¶ˆæ¯å†…å®¹
4. æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·ï¼š/users
5. ä¿®æ”¹ç”¨æˆ·åï¼š/name æ–°ç”¨æˆ·å
6. é€€å‡ºï¼š/quit

> 
ðŸ’¬ ç”¨æˆ·åå·²æ›´æ–°ä¸º: alias

> 
ðŸ”’ ç§èŠæ¶ˆæ¯ [poy|070c91c2]: ä½ åœ¨å“ªå„¿

> @070c91c2: beijing

ðŸ’¬ å·²ç§èŠå‘é€è‡³ [poy|070c91c2]

> 
ðŸ”’ ç§èŠæ¶ˆæ¯ [poy|070c91c2]: o

> @poy: ä½ å‘¢

ðŸ’¬ å·²ç§èŠå‘é€è‡³ [poy|070c91c2]

> 
```

> EnhancedChatClient B ç”¨æˆ·

```
å·²è¿žæŽ¥åˆ°åœ°å€ä¸º ''127.0.0.1:62666'ï¼Œä¼ è¾“: 'å¥—æŽ¥å­—'' çš„ç›®æ ‡è™šæ‹Ÿæœº
è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å: 
poy
æ¬¢è¿Ž poy åŠ å…¥èŠå¤©å®¤ï¼
\å·²è¿žæŽ¥åˆ°æœåŠ¡å™¨ localhost:8080
å·²è¿žæŽ¥åˆ°èŠå¤©æœåŠ¡å™¨ï¼

ðŸŽ‰ æ¬¢è¿Žè¿žæŽ¥åˆ°èŠå¤©æœåŠ¡å™¨ï¼
ä½¿ç”¨è¯´æ˜Žï¼š
1. æ™®é€šæ¶ˆæ¯ï¼šç›´æŽ¥è¾“å…¥å†…å®¹
2. ç§èŠæ¶ˆæ¯ï¼š@ç”¨æˆ·å:æ¶ˆæ¯å†…å®¹ æˆ– @070c91c2:æ¶ˆæ¯å†…å®¹
3. å¹¿æ’­æ¶ˆæ¯ï¼š#å¹¿æ’­:æ¶ˆæ¯å†…å®¹
4. æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·ï¼š/users
5. ä¿®æ”¹ç”¨æˆ·åï¼š/name æ–°ç”¨æˆ·å
6. é€€å‡ºï¼š/quit

> 
ðŸ’¬ ç”¨æˆ·åå·²æ›´æ–°ä¸º: poy

> 
âš¡ ç³»ç»Ÿ: æ–°ç”¨æˆ· Client_8549e568 åŠ å…¥äº†èŠå¤©å®¤

> /users

âœ… æœåŠ¡å™¨å·²æ”¶åˆ°æ‚¨çš„æ¶ˆæ¯: \/users

> /users

ðŸ‘¥ åœ¨çº¿ç”¨æˆ·åˆ—è¡¨:
- alias (ID=8549e568)
- poy (ID=070c91c2)

> @alias: ä½ åœ¨å“ªå„¿

ðŸ’¬ å·²ç§èŠå‘é€è‡³ [alias|8549e568]

> 
ðŸ”’ ç§èŠæ¶ˆæ¯ [alias|8549e568]: beijing

> @8549e568: o

ðŸ’¬ å·²ç§èŠå‘é€è‡³ [alias|8549e568]

> 
ðŸ”’ ç§èŠæ¶ˆæ¯ [alias|8549e568]: ä½ å‘¢

> 
```